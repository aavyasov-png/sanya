# –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ö–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞ —Å bcrypt

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–°–∏—Å—Ç–µ–º–∞ –∫–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥–µ–ª–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å bcrypt-—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ API endpoints:

- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞**: POST /api/auth/verify-code (bcrypt.compare –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–¥–∞**: POST /api/admin/access-codes (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è + bcrypt.hash –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- **–°–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤**: GET /api/admin/access-codes (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Å–∞–º–∏—Ö –∫–æ–¥–æ–≤)
- **–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–¥–∞**: DELETE /api/admin/access-codes?id=<uuid> (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ is_disabled)

## üöÄ –®–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor:
```sql
-- migrations/001_users_and_roles.sql (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞)
```

–¢–∞–±–ª–∏—Ü–∞ `access_codes` —É–∂–µ –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:
- id, code_hash, role_to_assign, max_uses, uses_count, expires_at, is_disabled, created_by, created_at, note

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoints

API endpoints –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã:
- `/api/auth/verify-code.ts` ‚úÖ
- `/api/admin/access-codes.ts` ‚úÖ
- `/api/_lib/auth.ts` (hashPassword, verifyPassword, generateAccessCode) ‚úÖ

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
npm run dev
```

### 4. –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –∫–æ–¥

1. –í–æ–π–¥–∏—Ç–µ —Å –∫–æ–¥–æ–º SANYA4565 (—Ö–∞—Ä–¥–∫–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∞)
2. –û—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ö–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - –†–æ–ª—å: Viewer/Editor/Admin/Owner
   - –ú–∞–∫—Å. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π: 0 (–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ) –∏–ª–∏ —á–∏—Å–ª–æ
   - –°—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
   - –ó–∞–º–µ—Ç–∫–∞: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
5. –ù–∞–∂–º–∏—Ç–µ "üîê –°–æ–∑–¥–∞—Ç—å –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞"
6. **–í–ê–ñ–ù–û**: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥! –û–Ω –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω.

### 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥

1. –í—ã–π–¥–∏—Ç–µ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –í–≤–µ–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–æ–¥
3. –ü—Ä–∏–º–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞
4. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏—Å–≤–æ–∏—Ç —Ä–æ–ª—å –∏ —Å–æ–∑–¥–∞—Å—Ç JWT —Å–µ—Å—Å–∏—é

## üîç –û—Ç–ª–∞–¥–∫–∞

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools Console –ø—Ä–∏ –≤—Ö–æ–¥–µ:

```javascript
[CODE] Checking code: ABC123...
[CODE] API response status: 200
[CODE] API success: { success: true, token: "...", user: {...} }
[CODE] Code valid, granting access with role: viewer
```

localStorage:
- `access_ok = "1"`
- `user_role = "viewer"`
- `session_token = "jwt_token_here"`

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –ö–æ–¥—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (12 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–∫–≤—ã+—Ü–∏—Ñ—Ä—ã)
- –•–µ—à–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î (bcrypt rounds=10)
- –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–æ–≤ –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ)
- –£–¥–∞–ª–µ–Ω–∏–µ = is_disabled=true (–∫–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –ë–î –¥–ª—è –∞—É–¥–∏—Ç–∞)

## üìÑ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. [FIX_ACCESS_CODES.md](FIX_ACCESS_CODES.md)